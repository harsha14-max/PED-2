<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Price Elasticity of Demand Calculator</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <nav class="navbar brandbar sticky-top">
    <div class="container py-2">
      <div class="d-flex align-items-center gap-3">
        <div class="fw-semibold">PED Calculator</div>
        <span class="pill">Arc elasticity</span>
      </div>
      <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-outline-light" href="/">Reset</a>
      </div>
    </div>
  </nav>

  <div class="container py-4 py-lg-5">
    <div class="row align-items-start g-4">
      <div class="col-12">
        <div class="mb-2">
          <h1 class="fw-bold mb-1">Price Elasticity of Demand</h1>
          <div class="muted">
            Compute PED from two price–quantity observations using the arc (midpoint) method.
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-5">
        <div class="card shadow-lg p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="fw-semibold">Inputs</div>
            <div class="muted small">Enter numeric values</div>
          </div>

          <form id="pedForm" method="post" novalidate>
            <div class="row g-3">
              <div class="col-12">
                <div class="muted small mb-1">Prices</div>
              </div>
              <div class="col-md-6">
                <label for="p1" class="form-label">Initial price (P₁)</label>
                <div class="input-group">
                  <span class="input-group-text">P₁</span>
                  <input
                    type="number"
                    step="0.0001"
                    min="0"
                    class="form-control"
                    id="p1"
                    name="p1"
                    value="{{ form_values.p1 }}"
                    placeholder="10.0"
                    required
                  />
                  <div class="invalid-feedback">Please enter P₁.</div>
                </div>
              </div>
              <div class="col-md-6">
                <label for="p2" class="form-label">New price (P₂)</label>
                <div class="input-group">
                  <span class="input-group-text">P₂</span>
                  <input
                    type="number"
                    step="0.0001"
                    min="0"
                    class="form-control"
                    id="p2"
                    name="p2"
                    value="{{ form_values.p2 }}"
                    placeholder="12.0"
                    required
                  />
                  <div class="invalid-feedback">Please enter P₂.</div>
                </div>
              </div>

              <div class="col-12 mt-2">
                <div class="muted small mb-1">Quantities</div>
              </div>
              <div class="col-md-6">
                <label for="q1" class="form-label">Initial quantity (Q₁)</label>
                <div class="input-group">
                  <span class="input-group-text">Q₁</span>
                  <input
                    type="number"
                    step="0.0001"
                    min="0"
                    class="form-control"
                    id="q1"
                    name="q1"
                    value="{{ form_values.q1 }}"
                    placeholder="100"
                    required
                  />
                  <div class="invalid-feedback">Please enter Q₁.</div>
                </div>
              </div>
              <div class="col-md-6">
                <label for="q2" class="form-label">New quantity (Q₂)</label>
                <div class="input-group">
                  <span class="input-group-text">Q₂</span>
                  <input
                    type="number"
                    step="0.0001"
                    min="0"
                    class="form-control"
                    id="q2"
                    name="q2"
                    value="{{ form_values.q2 }}"
                    placeholder="80"
                    required
                  />
                  <div class="invalid-feedback">Please enter Q₂.</div>
                </div>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary btn-lg">
                Calculate PED
              </button>
            </div>

            <div class="muted small mt-3">
              Tip: Use the same time period and unit basis for both observations (e.g., weekly price and weekly quantity).
            </div>
          </form>
        </div>

        {% if error %}
        <div class="alert alert-danger mt-3" role="alert">
          {{ error }}
        </div>
        {% endif %}
      </div>

      <div class="col-12 col-lg-7">
        {% if result %}
        <div class="card shadow-lg p-4">
          <div class="d-flex justify-content-between align-items-start gap-3">
            <div>
              <div class="muted small">Elasticity result</div>
              <div class="d-flex align-items-end gap-2">
                <div class="display-6 fw-bold mb-0">PED</div>
                <div class="display-6 fw-bold mb-0">=</div>
                <div class="display-6 fw-bold mb-0">{{ result.ped_arc_abs }}</div>
              </div>
              <div class="muted small mt-1">
                Arc method |PED| = {{ result.ped_arc_abs }} &nbsp;·&nbsp;
                Proportionate |PED| = {{ result.ped_prop_abs }}
              </div>
              <div class="muted small mt-1">
                Note: For many “normal” goods, PED is typically negative (price up → quantity down).
              </div>
            </div>

            {% set cls = result.classification %}
            {% if "Elastic" in cls or "elastic" in cls %}
              {% if "Inelastic" in cls or "inelastic" in cls %}
                {% set badge_class = "badge-inelastic" %}
              {% else %}
                {% set badge_class = "badge-elastic" %}
              {% endif %}
            {% elif "Unit" in cls or "unit" in cls %}
              {% set badge_class = "badge-unit" %}
            {% else %}
              {% set badge_class = "badge-inelastic" %}
            {% endif %}

            <div class="text-end">
              <div class="badge {{ badge_class }} px-3 py-2">
                {{ result.classification }}
              </div>
              <div class="muted small mt-2">
                |PED| vs 1
              </div>
            </div>
          </div>

          <div class="row g-3 mt-3">
            <div class="col-sm-6 col-lg-3">
              <div class="kpi">
                <div class="label">ΔPrice</div>
                <div class="value">{{ result.delta_p }}</div>
              </div>
            </div>
            <div class="col-sm-6 col-lg-3">
              <div class="kpi">
                <div class="label">ΔQuantity</div>
                <div class="value">{{ result.delta_q }}</div>
              </div>
            </div>
            <div class="col-sm-6 col-lg-3">
              <div class="kpi">
                <div class="label">%ΔPrice (arc)</div>
                <div class="value">{{ result.pct_change_p }}%</div>
              </div>
            </div>
            <div class="col-sm-6 col-lg-3">
              <div class="kpi">
                <div class="label">%ΔQuantity (arc)</div>
                <div class="value">{{ result.pct_change_q }}%</div>
              </div>
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <div class="chart-wrap">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-semibold">Demand plot</div>
                  <div class="muted small">Price vs Quantity</div>
                </div>
                <canvas id="chartDemand" height="220"></canvas>
              </div>
            </div>
            <div class="col-md-6">
              <div class="chart-wrap">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <div class="fw-semibold">% changes</div>
                  <div class="muted small">Arc method</div>
                </div>
                <canvas id="chartPct" height="220"></canvas>
              </div>
            </div>
          </div>

          <div class="mt-4">
            <div class="muted small mb-1">Quick interpretation</div>
            <div class="muted">
              <div><strong>|PED| &lt; 1</strong> → Inelastic (quantity changes less than price)</div>
              <div><strong>|PED| = 1</strong> → Unit elastic</div>
              <div><strong>|PED| &gt; 1</strong> → Elastic (quantity changes more than price)</div>
            </div>
          </div>
        </div>

        <script>
          window.PED_RESULT = {{ result | tojson }};
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
        {% else %}
        <div class="card shadow-lg p-4">
          <div class="fw-semibold mb-2">Results will appear here</div>
          <div class="muted">
            Enter \(P_1, P_2, Q_1, Q_2\) and click <strong>Calculate PED</strong> to see the computed elasticity, key metrics, and charts.
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>

